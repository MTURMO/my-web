<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Crear Quiniela</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  font-family:'Inter',sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  padding:20px;
  background:#f9fafb;
}
h1{
  margin-bottom:15px;
  color:#333;
  font-size:1.8rem;
  text-align:center;
}
input{
  padding:10px;
  border:1px solid #ccc;
  border-radius:8px;
  margin:5px;
  width:100%;
  max-width:250px;
}
button{
  padding:10px 20px;
  border:none;
  border-radius:8px;
  margin-top:15px;
  background:#10b981;
  color:white;
  cursor:pointer;
  font-size:16px;
  transition:transform 0.2s;
}
button:hover{transform:translateY(-2px);}
#partidos{
  margin-top:20px;
  width:100%;
  max-width:300px;
}
.match-row{
  display:flex;
  gap:10px;
  margin-bottom:5px;
  flex-wrap:wrap;
}
a{
  margin-top:20px;
  color:#3b82f6;
  text-decoration:none;
  font-weight:500;
}
</style>
</head>
<body>

<h1>Crear Quiniela de la Semana</h1>

<div id="partidos"></div>

<div style="margin-top:20px;width:100%;max-width:300px;display:flex;flex-wrap:wrap;gap:5px;">
  <input type="text" id="local" placeholder="Equipo local">
  <input type="text" id="visitante" placeholder="Equipo visitante">
  <button onclick="agregarPartido()">➕ Añadir Partido</button>
</div>

<button id="guardarBtn">✅ Guardar Quiniela Oficial</button>

<a href="admin.html">⬅ Volver al menú admin</a>

<!-- Incluimos Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = "https://TU_SUPABASE_URL.supabase.co"; // ⚙️ tu URL
  const SUPABASE_ANON_KEY = "TU_SUPABASE_ANON_KEY"; // ⚙️ tu anon key
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
</script>

<script>
let partidos = [];

function agregarPartido(){
  const local = document.getElementById("local").value.trim();
  const visitante = document.getElementById("visitante").value.trim();
  if(!local || !visitante){
    alert("Introduce ambos equipos");
    return;
  }
  partidos.push({local, visitante});
  renderPartidos();
  document.getElementById("local").value = "";
  document.getElementById("visitante").value = "";
}

function renderPartidos(){
  const cont = document.getElementById("partidos");
  cont.innerHTML = "";
  partidos.forEach((p,i)=>{
    cont.innerHTML += `<div class="match-row">${i+1}. ${p.local} vs ${p.visitante}</div>`;
  });
}

document.getElementById("guardarBtn").addEventListener("click", async ()=>{
  if(partidos.length === 0){
    alert("Añade al menos un partido");
    return;
  }

  // Borramos quiniela anterior
  const { error: deleteError } = await supabase.from("quiniela_oficial").delete().neq("id", 0);
  if (deleteError) {
    alert("❌ Error eliminando quiniela anterior: " + deleteError.message);
    return;
  }

  // Insertamos la nueva
  const { error } = await supabase.from("quiniela_oficial").insert([
    { data: partidos, creada_el: new Date().toISOString() }
  ]);

  if(error){
    alert("❌ Error guardando la quiniela: " + error.message);
  } else {
    alert("✅ Quiniela guardada correctamente en Supabase");
    partidos = [];
    renderPartidos();
  }
});
</script>

</body>
</html>
